<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Sublime Code - Blog - UI Components with d3.js</title><meta content="width=device-width, initial-scale=1" name="viewport" /><link href="../../../../css/main.css" rel="stylesheet" /><link href="/css/clean-blog.min.css" rel="stylesheet" type="text/css" /><link href="/css/syntax.css" rel="stylesheet" type="text/css" /><link href="/css/rouge-syntax.css" rel="stylesheet" type="text/css" /><link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" /><link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" /><link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" /></head><body><!--Navigation--><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class="container-fluid"><!--Brand and toggle get grouped for better mobile display--><div class="navbar-header page-scroll"><button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Sublime Code</a></div><!--Collect the nav links, forms, and other content for toggling--><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"><ul class="nav navbar-nav navbar-right"><li><a href="/"> Home</a></li><li><a href="/#about">About</a></li><li><a href="/blog">Blog</a></li></ul></div><!--/.navbar-collapse--></div><!--/.container--></nav><!--Page Header--><header class="intro-header" style="background-image: url('https://download.unsplash.com/photo-1433838552652-f9a46b332c40')"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="site-heading"><h1>UI Components with d3.js</h1><hr class="small" /><span class="subheading">d3, ui, JavaScript</span></div></div></div></div></header><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><p>Today, we're going to look at doing something different with d3js. Most of the material online is geared towards creating visualizations with this amazing library, which is great, but it isn't the only thing we can use it for!</p>

<p>Before going heads in with the code, let's take a higher level look at what we'll be building.</p>

<p>For one of my projects, I had to build an 'Evidence Shoebox'; a place to put objects (named entities in the project) in various Evidence Boxes. I won't get into the details about what the project would acomplish but here is what is required of the Evidence Box.</p>

<p>The Evidence Box should have:</p>

<ol>
  <li>a header
    <ul>
      <li>a title</li>
      <li>a count of the entities within it</li>
      <li>an option to close/expand the body to save space</li>
    </ul>
  </li>
  <li>a body
    <ul>
      <li>the entities should be visible</li>
    </ul>
  </li>
</ol>

<p>Okay, that's simple enough. Before we actually go ahead I'd like to sketch this 'Evidence Box' out, so that we're are both clear on what it should like this. I find that doing this makes my life easier since I have a good idea of the final product;</p>

<p>Andâ€¦.voila!
<img src="/img/blog/ui-components-with-d3js/EvidenceBox.png" /></p>

<p>Here's what I'd like the component to look like. I've gone ahead and annoted the sketch so don't think that should be part of the ui! Interestingly, you'd might want to extend the project by giving the user an option to view something similar for say, a tutorial.</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td class="code"><pre><span class="c1">// our reusable chart named EvidenceBox</span>
<span class="kd">function</span> <span class="nx">EvidenceBox</span><span class="p">(){</span>
  <span class="c1">// default component values</span>
  <span class="kd">var</span> <span class="nx">width</span>  <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
      <span class="nx">height</span> <span class="o">=</span> <span class="mi">250</span><span class="p">;</span>
  
  <span class="c1">// our main function that the outsidecontext interacts with</span>
  <span class="kd">function</span> <span class="nx">component</span><span class="p">(</span><span class="nx">selection</span><span class="p">){</span>
      <span class="nx">selection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">){</span>

      <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="c1">// setter and getter methods for our component values</span>
  <span class="nx">component</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="nx">width</span><span class="p">;</span>
    <span class="nx">width</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">component</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">component</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="nx">height</span><span class="p">;</span>
    <span class="nx">height</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">component</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="nx">component</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Looks like our usual reusable charts except that I've changed the name to component since that's what the UI element is!</p>

<p>First step - build the outline</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="p">.</span>

<span class="kd">function</span> <span class="nx">component</span><span class="p">(</span><span class="nx">selection</span><span class="p">){</span>
  <span class="nx">selection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">){</span>
    <span class="c1">// get the div of the current selection</span>
    <span class="kd">var</span> <span class="nx">box</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="c1">// setup box size</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">style</span><span class="p">({</span>
      <span class="na">width</span><span class="p">:</span> <span class="nx">width</span><span class="o">+</span><span class="s1">'px'</span><span class="p">,</span>
      <span class="na">height</span><span class="p">:</span> <span class="nx">height</span><span class="o">+</span><span class="s1">'px'</span>
    <span class="p">});</span>

    <span class="c1">// setup the outline</span>
    <span class="nx">box</span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'border'</span><span class="p">,</span> <span class="s1">'2px solid black'</span><span class="p">);</span>
  <span class="p">})</span>  
<span class="p">}</span>

<span class="p">.</span>
</pre></td></tr></tbody></table>
</div>

<p>Great! Let's see if this actually works - write the following code after our EvidenceBox factory function.</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">eb</span> <span class="o">=</span> <span class="nx">EvidenceBox</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'#canvas'</span><span class="p">);</span>
<span class="nx">container</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'div'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'evidence'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">eb</span><span class="p">);</span>
</pre></td></tr></tbody></table>
</div>

<p>You'll need an index.html file with the required dependencies; d3.js and app.js</p>

<p>Bring up your webserver and you should be greeted with the following empty box with a border!</p>

<p><img src="/img/blog/ui-components-with-d3js/box-border.png" /></p>

<p>Let's add a header to our box.</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">EvidenceBox</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">width</span>        <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
      <span class="nx">height</span>       <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
      <span class="c1">// default height of the header</span>
      <span class="nx">headerHeight</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
      <span class="nx">headerColor</span> <span class="o">=</span> <span class="s1">'#4A90E2'</span><span class="p">,</span>
      <span class="nx">entityColor</span> <span class="o">=</span> <span class="s1">'#F5A623'</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">component</span><span class="p">(</span><span class="nx">selection</span><span class="p">){</span>
    <span class="nx">selection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">){</span>
      <span class="c1">// get the div of the current selection</span>
      <span class="kd">var</span> <span class="nx">box</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

      <span class="c1">// setup box size</span>
      <span class="nx">box</span><span class="p">.</span><span class="nx">style</span><span class="p">({</span>
        <span class="na">width</span><span class="p">:</span> <span class="nx">width</span><span class="o">+</span><span class="s1">'px'</span><span class="p">,</span>
        <span class="na">height</span><span class="p">:</span> <span class="nx">height</span><span class="o">+</span><span class="s1">'px'</span>
      <span class="p">});</span>

      <span class="c1">// setup the outline</span>
      <span class="nx">box</span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'border'</span><span class="p">,</span> <span class="s1">'2px solid black'</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">header</span> <span class="o">=</span> <span class="nx">box</span>
                    <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.header'</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="nx">d</span><span class="p">]);</span>
                  
      <span class="nx">header</span>
        <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'div'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'header'</span><span class="p">);</span>
      
      <span class="nx">header</span><span class="p">.</span><span class="nx">style</span><span class="p">({</span>
        <span class="na">height</span><span class="p">:</span> <span class="nx">headerHeight</span><span class="o">+</span><span class="s1">'px'</span><span class="p">,</span>
        <span class="s1">'background-color'</span><span class="p">:</span> <span class="nx">headerColor</span>
      <span class="p">});</span>
    <span class="p">})</span>  
  <span class="p">}</span>
  
  <span class="p">.</span>
  <span class="p">.</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Awesome! This is what you should have now.</p>

<p><img src="/img/blog/ui-components-with-d3js/box-header.png" /></p>

<p>Hmmmm. Where's the data? Let's throw in some.</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="s1">'Evidence 2'</span><span class="p">,</span>
    <span class="na">entities</span><span class="p">:</span> <span class="p">[</span>
      <span class="s1">'Casino'</span><span class="p">,</span>
      <span class="s1">'Craps'</span><span class="p">,</span>
      <span class="s1">'Loaded Dice'</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></td></tr></tbody></table>
</div>

<p>And modify our selection as follows</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">eb</span> <span class="o">=</span> <span class="nx">EvidenceBox</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="s1">'Evidence 2'</span><span class="p">,</span>
    <span class="na">entities</span><span class="p">:</span> <span class="p">[</span>
      <span class="s1">'Casino'</span><span class="p">,</span>
      <span class="s1">'Craps'</span><span class="p">,</span>
      <span class="s1">'Loaded Dice'</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
<span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'#chart'</span><span class="p">);</span>
<span class="nx">container</span>
  <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.evidence'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'div'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'evidence'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">eb</span><span class="p">);</span>
</pre></td></tr></tbody></table>
</div>

<p>Nothing on the visual front should have changed but we now have some data bound to our UI! We're going to make use of the 'title' attribute in our data by placing it in the header.</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre><span class="p">.</span>
<span class="p">.</span>
<span class="nx">header</span><span class="p">.</span><span class="nx">style</span><span class="p">({</span>
  <span class="na">height</span><span class="p">:</span> <span class="nx">headerHeight</span><span class="o">+</span><span class="s1">'px'</span><span class="p">,</span>
  <span class="s1">'background-color'</span><span class="p">:</span> <span class="nx">headerColor</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">headerText</span> <span class="o">=</span> <span class="nx">header</span>
                  <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.header-text'</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="nx">d</span><span class="p">]);</span>

<span class="nx">headerText</span>
  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'span'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'header-text'</span><span class="p">)</span>

<span class="nx">headerText</span>
  <span class="p">.</span><span class="nx">style</span><span class="p">({</span>
    <span class="s1">'line-height'</span><span class="p">,</span> <span class="nx">headerHeight</span><span class="o">+</span><span class="s1">'px'</span><span class="p">,</span>
    <span class="na">color</span><span class="p">:</span> <span class="s1">'white'</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">title</span> <span class="p">});</span>
</pre></td></tr></tbody></table>
</div>

<p><img src="/img/blog/ui-components-with-d3js/box-header-text.png" /></p>

<p>This component is already looking good. Let's add some of our entities to the body of the evidences.</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></td><td class="code"><pre><span class="p">.</span>
<span class="p">.</span>

<span class="nx">headerText</span>
  <span class="p">.</span><span class="nx">style</span><span class="p">({</span>
    <span class="s1">'line-height'</span><span class="p">:</span> <span class="nx">headerHeight</span><span class="o">+</span><span class="s1">'px'</span><span class="p">,</span>
    <span class="na">color</span><span class="p">:</span> <span class="s1">'white'</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">title</span> <span class="p">});</span>

<span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">box</span>
            <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.body'</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

<span class="nx">body</span>
  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'div'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'body'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">body</span>
                <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.entity'</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">entities</span><span class="p">);</span>

<span class="nx">entities</span>
  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'div'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'entity'</span><span class="p">);</span>       

<span class="nx">entities</span>
  <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'margin'</span><span class="p">,</span> <span class="s1">'15px'</span><span class="p">);</span>

<span class="nx">entities</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entityData</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">entityText</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.entity-text'</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="nx">entityData</span><span class="p">]);</span>
  <span class="nx">entityText</span>
    <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'span'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'entity-text'</span><span class="p">);</span>

  <span class="nx">entityText</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">({</span>
      <span class="s1">'background-color'</span><span class="p">:</span> <span class="nx">entityColor</span><span class="p">,</span>
      <span class="s1">'padding'</span><span class="p">:</span> <span class="s1">'5px'</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">;</span> <span class="p">});</span>
<span class="p">});</span>
</pre></td></tr></tbody></table>
</div>

<p><img src="/img/blog/ui-components-with-d3js/entities.png" /></p>

<p>Now that we have our entities, we're going to show the count in the header.</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre><span class="p">.</span>
<span class="p">.</span>
<span class="nx">headerText</span>
  <span class="p">.</span><span class="nx">style</span><span class="p">({</span>
    <span class="s1">'line-height'</span><span class="p">:</span> <span class="nx">headerHeight</span><span class="o">+</span><span class="s1">'px'</span><span class="p">,</span>
    <span class="na">color</span><span class="p">:</span> <span class="s1">'white'</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">title</span> <span class="p">});</span>

<span class="kd">var</span> <span class="nx">entityCount</span> <span class="o">=</span> <span class="nx">header</span>
                    <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.entity-count'</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="nx">d</span><span class="p">]);</span>

<span class="nx">entityCount</span>
  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'div'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'entity-count'</span><span class="p">);</span>

<span class="nx">entityCount</span>
  <span class="p">.</span><span class="nx">style</span><span class="p">({</span>
    <span class="na">display</span><span class="p">:</span> <span class="s1">'inline-block'</span><span class="p">,</span>
    <span class="s1">'background-color'</span><span class="p">:</span> <span class="s1">'#4A4A4A'</span><span class="p">,</span>
    <span class="na">color</span><span class="p">:</span> <span class="s1">'white'</span><span class="p">,</span>
    <span class="na">float</span><span class="p">:</span> <span class="s1">'right'</span><span class="p">,</span>
    <span class="na">margin</span><span class="p">:</span> <span class="s1">'10px 10px'</span><span class="p">,</span>
    <span class="s1">'line-height'</span><span class="p">:</span> <span class="s1">'24px'</span><span class="p">,</span>
    <span class="na">width</span><span class="p">:</span> <span class="nx">headerHeight</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="s1">'px'</span><span class="p">,</span>
    <span class="s1">'text-align'</span><span class="p">:</span> <span class="s1">'center'</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="p">});</span>
</pre></td></tr></tbody></table>
</div>

<p><img src="/img/blog/ui-components-with-d3js/entity-count.png" /></p>

<p>Hang in there! We're almost done! We're going to add the open/close functionality and we'd have a pretty useful component!</p>

<p>Let's start by including the font-awesome collection:</p>

<p>In your index.html file, include the font-awesome css file.</p>

<p><code>&lt;link href="/font-awesome/css/font-awesome.min.css" rel'stylesheet' type="text/css'</code></p>

<p>Add the follwing code above the previous listing. We do this because we're using the 'float: right;' property on both elements and we want the open/close icon to be at the right most part of the header. If we instead wrote it after the previous listing, we'd have the element on the left of the entity count.</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">openClose</span> <span class="o">=</span> <span class="nx">header</span>
                    <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.open-close'</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="nx">d</span><span class="p">]);</span>

<span class="nx">openClose</span>
  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'i'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">classed</span><span class="p">({</span>
    <span class="s1">'open-close'</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s1">'fa'</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'data-is-open'</span><span class="p">,</span> <span class="s1">'true'</span><span class="p">);</span>


<span class="nx">openClose</span>
  <span class="p">.</span><span class="nx">style</span><span class="p">({</span>
    <span class="na">float</span><span class="p">:</span> <span class="s1">'right'</span><span class="p">,</span>
    <span class="na">margin</span><span class="p">:</span> <span class="s1">'10px 10px'</span><span class="p">,</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'fa-minus'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">isOpen</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'data-is-open'</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">isOpen</span> <span class="o">===</span> <span class="s1">'true'</span><span class="p">){</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'fa-plus'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">isOpen</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'data-is-open'</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">isOpen</span> <span class="o">===</span> <span class="s1">'true'</span><span class="p">){</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">});</span>
</pre></td></tr></tbody></table>
</div>

<p>Note in the above listing, we're adding a data-is-open custom attribute and setting it to the default value of true. We'll use this attribute to show/hide the body. Your evidence box should look like the following listing:</p>

<p><img src="/img/blog/ui-components-with-d3js/open-close-button.png" /></p>

<p>I hope you can see the light at the end of the tunnel. We're going to add open/close functionality.</p>

<p>Add the following to the openClose variable above</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></td><td class="code"><pre><span class="nx">openClose</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">({</span>
      <span class="na">float</span><span class="p">:</span> <span class="s1">'right'</span><span class="p">,</span>
      <span class="na">margin</span><span class="p">:</span> <span class="s1">'10px 10px'</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'fa-minus'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">isOpen</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'data-is-open'</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">isOpen</span> <span class="o">===</span> <span class="s1">'true'</span><span class="p">){</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'fa-plus'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">isOpen</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'data-is-open'</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">isOpen</span> <span class="o">===</span> <span class="s1">'true'</span><span class="p">){</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">isOpen</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'data-is-open'</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">isOpen</span> <span class="o">===</span> <span class="s1">'true'</span><span class="p">){</span> 
        <span class="nx">self</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'data-is-open'</span><span class="p">,</span> <span class="s1">'false'</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'open-close fa fa-plus'</span><span class="p">);</span>
        <span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'display'</span><span class="p">,</span> <span class="s1">'none'</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'data-is-open'</span><span class="p">,</span> <span class="s1">'true'</span><span class="p">)</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'open-close fa fa-minus'</span><span class="p">);</span>
        <span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'display'</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
</pre></td></tr></tbody></table>
</div>

<p>We also need to remove the 'height' property from the 'box' object to ensure that the body collapses.</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="c1">// setup box size</span>
<span class="nx">box</span><span class="p">.</span><span class="nx">style</span><span class="p">({</span>
  <span class="na">width</span><span class="p">:</span> <span class="nx">width</span><span class="o">+</span><span class="s1">'px'</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// setup the outline</span>
<span class="nx">box</span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s1">'border'</span><span class="p">,</span> <span class="s1">'2px solid black'</span><span class="p">);</span>
</pre></td></tr></tbody></table>
</div>

<p>And you're done! Good job getting this far! Clicking on the open/close button should show/hide the div like this:</p>

<p><img style="display: inline-block;" src="/img/blog/ui-components-with-d3js/open-box.png" />
<img style="display: inline-block;" src="/img/blog/ui-components-with-d3js/close-box.png" /></p>

<p>Change the container code to do the following. It's going to update the component with the new data!</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">evidences</span> <span class="o">=</span> <span class="nx">container</span>
                  <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'.evidence'</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="nx">evidences</span> 
  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'div'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'evidence'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">eb</span><span class="p">);</span>


<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="s1">'Evidence Changed'</span><span class="p">,</span>
    <span class="na">entities</span><span class="p">:</span> <span class="p">[</span>
      <span class="s1">'Casino'</span><span class="p">,</span>
      <span class="s1">'Loaded Dice'</span><span class="p">,</span>
      <span class="s1">'Blackjack'</span>
    <span class="p">]</span>
  <span class="p">};</span>

  <span class="nx">evidences</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="nx">eb</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
</pre></td></tr></tbody></table>
</div>

<p>d3js is a powerful tool for creating resuable components, not just data visualizations and I hope that this introduction will have you using it in your own work!</p>

<p>Until next timeâ€¦</p>
</div><script src="../../../../js/main.js"></script><script src="../../../../js/clean-blog.min.js"></script></div></div></body></html>